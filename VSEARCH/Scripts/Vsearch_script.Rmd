---
title: "Vsearch_Table"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
library(data.table)
library(tidyverse)
library(dplyr)
library(stringr)

Table <- fread("/Users/alexkid/Desktop/vsearch/all.otutab.txt")
Taxonomy <- read.delim("/Users/alexkid/Desktop/vsearch/ASV_tax_raw.txt", sep="\t", header=F)
Taxonomy$V1 = gsub(";.*","",Taxonomy$V1)
Taxonomy$V6 = lapply(Taxonomy$V1, gsub, pattern = "OTU_", replacement = "")
Taxonomy <- as.data.frame(Taxonomy)
Taxonomy$V6 <- unlist(Taxonomy$V6)
write.csv(Taxonomy, "/Users/alexkid/Desktop/vsearch/Taxonomy.csv", row.names = FALSE)
Taxonomy <- read.csv("/Users/alexkid/Desktop/vsearch/Taxonomy.csv")
names(Taxonomy)[1] <- 'OTU'
names(Taxonomy)[2] <- 'Taxonomy'
names(Taxonomy)[3] <- 'Useless'
names(Taxonomy)[4] <- 'Taxonomy2'
names(Taxonomy)[5] <- 'Useless2'
names(Taxonomy)[6] <- 'Sort'
Taxonomy <- Taxonomy[order(Taxonomy$Sort) , ]

Taxonomy2 <- subset(Taxonomy, select=c("OTU", "Taxonomy"))
Taxonomy2$Taxonomy = gsub("([0-9].[0-9])","",Taxonomy2$Taxonomy)
Taxonomy2$Taxonomy = gsub("([0-9])","",Taxonomy2$Taxonomy)
Taxonomy2$Taxonomy <- gsub("[()]", "", Taxonomy2$Taxonomy)
Taxonomy2$Taxonomy = gsub("d:","",Taxonomy2$Taxonomy)
Taxonomy2$Taxonomy = gsub("c:","",Taxonomy2$Taxonomy)
Taxonomy2$Taxonomy = gsub("p:","",Taxonomy2$Taxonomy)
Taxonomy2$Taxonomy = gsub("o:","",Taxonomy2$Taxonomy)
Taxonomy2$Taxonomy = gsub("f:","",Taxonomy2$Taxonomy)
Taxonomy2$Taxonomy = gsub("g:","",Taxonomy2$Taxonomy)
Taxonomy2$Taxonomy = gsub("s:","",Taxonomy2$Taxonomy)

Taxonomy3 <- as.data.frame(str_split_fixed(Taxonomy2$Taxonomy, ",", 7))
names(Taxonomy3)[1] <- 'Kingdom'
names(Taxonomy3)[2] <- 'Phylum'
names(Taxonomy3)[3] <- 'Class'
names(Taxonomy3)[4] <- 'Order'
names(Taxonomy3)[5] <- 'Family'
names(Taxonomy3)[6] <- 'Genus'
names(Taxonomy3)[7] <- 'Species'

Taxonomy3$OTU = Taxonomy2$OTU
Taxonomy3 <- Taxonomy3 %>% relocate(OTU, .before = Kingdom)
names(Table)[1] <- 'OTU'
Table$Sort = lapply(Table$OTU, gsub, pattern = "OTU_", replacement = "")
Table <- as.data.frame(Table)
Table$Sort <- unlist(Table$Sort)
write.csv(Table, "/Users/alexkid/Desktop/vsearch/OTU_Table.csv", row.names = FALSE)
Table <- read.csv("/Users/alexkid/Desktop/vsearch/OTU_Table.csv")
Table <- Table[order(Table$Sort) , ]

OTU_Table = Table
OTU_Table$OTU = Taxonomy3$Species
names(OTU_Table)[1] <- 'Species'

OTU_Table2 <- OTU_Table %>% group_by(Species) %>% summarise_each(funs(max)) 
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
